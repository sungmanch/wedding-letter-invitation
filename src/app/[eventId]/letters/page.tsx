'use client'

import { useState } from 'react'
import Link from 'next/link'
import { useParams } from 'next/navigation'
import { ArrowLeft, Lock, Clock, CreditCard, ChevronLeft, ChevronRight, Heart } from 'lucide-react'
import { Button, Card, Badge } from '@/components/ui'
import { cn } from '@/lib/utils'

// Mock letter data
const mockLetters = [
  {
    id: '1',
    guestName: 'ê¹€ë¯¼ì§€',
    content: 'ê²°í˜¼ ì§„ì§œ ì¶•í•˜í•´! ìš°ë¦¬ ëŒ€í•™ë•Œë¶€í„° ì¹œêµ¬í•˜ë©´ì„œ ë„¤ê°€ ì´ë ‡ê²Œ í–‰ë³µí•´í•˜ëŠ” ëª¨ìŠµ ë³´ë‹ˆê¹Œ ë‚˜ë„ ë„ˆë¬´ ê¸°ë» ğŸ’• ì•ìœ¼ë¡œë„ ì§€ê¸ˆì²˜ëŸ¼ í–‰ë³µí•˜ê²Œ ì‚´ì•„!',
    stickers: ['ğŸ’•', 'ğŸ‰', 'ğŸ’'],
    createdAt: new Date(),
  },
  {
    id: '2',
    guestName: 'ì´ìˆ˜ì§„',
    content: 'ì˜ˆìœ ì‹ ë¶€ê°€ ë  ë„ˆì—ê²Œ! í•­ìƒ ì‘ì›í• ê²Œ. ê²°í˜¼ì‹ ë‚  í‘í‘ ìš¸ ê²ƒ ê°™ì•„ ã… ã… ',
    stickers: ['ğŸ’’', 'ğŸ‘°', 'ğŸ¤'],
    createdAt: new Date(),
  },
  {
    id: '3',
    guestName: 'ë°•ì§€í˜„',
    content: 'ë“œë””ì–´ ê²°í˜¼ì´ë¼ë‹ˆ! ì²­ì²©ì¥ ëª¨ì„ ê¸°ëŒ€ëœë‹¤ ã…ã… ë§›ìˆëŠ” ê±° ë¨¹ìœ¼ë©´ì„œ ì¶•í•˜í•´ì¤„ê²Œ!',
    stickers: ['ğŸ¥‚', 'âœ¨'],
    createdAt: new Date(),
  },
]

export default function LettersPage() {
  const params = useParams()
  const eventId = params.eventId as string
  const [currentIndex, setCurrentIndex] = useState(0)

  // Mock unlock status
  const isUnlocked = true // TODO: ì‹¤ì œ ìƒíƒœ í™•ì¸
  const daysUntilUnlock = 14

  const handlePrev = () => {
    setCurrentIndex((prev) => (prev > 0 ? prev - 1 : mockLetters.length - 1))
  }

  const handleNext = () => {
    setCurrentIndex((prev) => (prev < mockLetters.length - 1 ? prev + 1 : 0))
  }

  if (!isUnlocked) {
    return (
      <main className="min-h-screen">
        {/* Header */}
        <header className="sticky top-0 z-10 border-b border-cream bg-white/80 backdrop-blur-sm">
          <div className="flex h-14 items-center px-4">
            <Link
              href={`/${eventId}`}
              className="flex items-center text-charcoal/60 hover:text-charcoal"
            >
              <ArrowLeft className="h-5 w-5" />
            </Link>
            <h1 className="flex-1 text-center font-semibold text-charcoal">
              í¸ì§€í•¨
            </h1>
            <div className="w-5" />
          </div>
        </header>

        {/* Locked State */}
        <div className="flex min-h-[60vh] flex-col items-center justify-center px-4 text-center">
          <div className="mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-cream">
            <Lock className="h-10 w-10 text-charcoal/30" />
          </div>
          <h2 className="mb-2 text-xl font-bold text-charcoal">
            {mockLetters.length}í†µì˜ í¸ì§€ê°€ ë„ì°©í–ˆì–´ìš”
          </h2>
          <p className="mb-6 text-charcoal/60">
            ì•„ì§ ì—´ëŒí•  ìˆ˜ ì—†ì–´ìš”
          </p>

          {/* Options */}
          <div className="w-full max-w-sm space-y-4">
            <Card className="p-4">
              <div className="flex items-center gap-3">
                <div className="flex h-10 w-10 items-center justify-center rounded-full bg-blush-pink-50">
                  <Clock className="h-5 w-5 text-blush-pink" />
                </div>
                <div className="flex-1 text-left">
                  <p className="font-medium text-charcoal">ë¬´ë£Œ ì—´ëŒ</p>
                  <p className="text-sm text-charcoal/60">
                    D-{daysUntilUnlock}ì¼ í›„ ì—´ëŒ ê°€ëŠ¥
                  </p>
                </div>
              </div>
            </Card>

            <Card className="border-blush-pink p-4">
              <div className="flex items-center gap-3">
                <div className="flex h-10 w-10 items-center justify-center rounded-full bg-blush-pink">
                  <CreditCard className="h-5 w-5 text-white" />
                </div>
                <div className="flex-1 text-left">
                  <p className="font-medium text-charcoal">ì¦‰ì‹œ ì—´ëŒ</p>
                  <p className="text-sm text-charcoal/60">
                    ê²°ì œ í›„ ë°”ë¡œ ì—´ëŒ ê°€ëŠ¥
                  </p>
                </div>
                <Badge>9,900ì›</Badge>
              </div>
              <Button size="lg" fullWidth className="mt-4">
                ê²°ì œí•˜ê³  ë°”ë¡œ ë³´ê¸°
              </Button>
            </Card>
          </div>
        </div>
      </main>
    )
  }

  const currentLetter = mockLetters[currentIndex]

  return (
    <main className="min-h-screen bg-gradient-to-b from-blush-pink-50 to-white">
      {/* Header */}
      <header className="sticky top-0 z-10 border-b border-cream bg-white/80 backdrop-blur-sm">
        <div className="flex h-14 items-center px-4">
          <Link
            href={`/${eventId}`}
            className="flex items-center text-charcoal/60 hover:text-charcoal"
          >
            <ArrowLeft className="h-5 w-5" />
          </Link>
          <h1 className="flex-1 text-center font-semibold text-charcoal">
            í¸ì§€í•¨
          </h1>
          <div className="w-5" />
        </div>
      </header>

      {/* Letter Counter */}
      <div className="flex items-center justify-center gap-2 py-4">
        <Heart className="h-4 w-4 text-blush-pink" />
        <span className="text-sm text-charcoal/60">
          {currentIndex + 1} / {mockLetters.length}
        </span>
      </div>

      {/* Letter Card */}
      <div className="relative px-4">
        <Card className="mx-auto max-w-sm overflow-hidden">
          {/* Letter Header */}
          <div className="bg-gradient-to-r from-blush-pink to-soft-gold p-4 text-white">
            <p className="text-lg font-semibold">
              From. {currentLetter.guestName}
            </p>
          </div>

          {/* Letter Content */}
          <div className="p-6">
            <p className="whitespace-pre-wrap text-charcoal leading-relaxed">
              {currentLetter.content}
            </p>

            {/* Stickers */}
            {currentLetter.stickers && currentLetter.stickers.length > 0 && (
              <div className="mt-4 flex gap-2">
                {currentLetter.stickers.map((sticker, i) => (
                  <span key={i} className="text-2xl">
                    {sticker}
                  </span>
                ))}
              </div>
            )}
          </div>
        </Card>

        {/* Navigation Arrows */}
        <button
          onClick={handlePrev}
          className="absolute left-0 top-1/2 -translate-y-1/2 rounded-full bg-white p-2 shadow-md hover:bg-cream"
        >
          <ChevronLeft className="h-6 w-6 text-charcoal" />
        </button>
        <button
          onClick={handleNext}
          className="absolute right-0 top-1/2 -translate-y-1/2 rounded-full bg-white p-2 shadow-md hover:bg-cream"
        >
          <ChevronRight className="h-6 w-6 text-charcoal" />
        </button>
      </div>

      {/* Dots */}
      <div className="flex justify-center gap-2 py-6">
        {mockLetters.map((_, i) => (
          <button
            key={i}
            onClick={() => setCurrentIndex(i)}
            className={cn(
              'h-2 w-2 rounded-full transition-all',
              i === currentIndex ? 'w-6 bg-blush-pink' : 'bg-cream'
            )}
          />
        ))}
      </div>
    </main>
  )
}
